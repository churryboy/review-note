<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Version: v2.5.0 - Production Deployment -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="google-site-verification" content="0OtrYCOU8M82-LcG2_Qq3Y6HZyRt_nlXg1vKK2aaHWE" />
    <title>복습노트 v2.5 - 문제 스캔 & 저장</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ctext y='50' font-size='48'%3E📝%3C/text%3E%3C/svg%3E">    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
      window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] }, svg: { fontCache: 'global' } };
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
    <!-- Auth Page View -->
    <div id="authView" class="auth-view" style="display:none !important;">
        <div class="auth-card">
            <div class="auth-header">
                <i class="fas fa-book"></i>
                <div class="auth-title">스마트 오답노트</div>
            </div>
            <div class="auth-body">
                <div class="auth-row">
                    <input id="authNickname" type="text" maxlength="40" placeholder="닉네임" />
                </div>
                <button id="authActionBtn" class="btn btn--primary btn--full btn--lg">시작하기</button>                <div id="authError" class="pin-error" style="display:none !important;"></div>
            </div>
        </div>
    </div>

    <!-- App Header -->
    <header class="app-header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-book"></i>
                <span class="logo-text">스마트 오답노트</span>
            </div>
            <button id="logoutBtn" class="btn btn--ghost btn--circle btn--sm" title="계정">                <img id="headerAvatar" src="" alt="avatar" style="width:24px; height:24px; border-radius:999px; object-fit:cover;" />
            </button>
        </div>
        <div class="profile-dropdown" id="profileDropdown" style="display:none !important;">
            <div class="profile-header">
                <img id="profileAvatar" src="" alt="avatar">
                <div class="profile-info">
                    <div class="profile-name" id="profilePublicId">-</div>
                    <div class="profile-email" id="profileNickname">-</div>
                </div>
            </div>
            <div class="profile-actions">
                <button class="btn btn--secondary btn--sm" id="profileLogoutBtn"><i class="fas fa-sign-out-alt"></i><span>로그아웃</span></button>            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- n회독 View -->
        <div class="round-view" id="roundNView">
            <div class="pop-quiz-desc" id="popQuizDesc">
                <div class="desc-text">
                    <div class="desc-body">카드를 왼쪽으로 스와이프 하면 회독이 오르고<br>오른쪽으로 스와이프하면 팝퀴즈로 보내집니다</div>
                </div>
            </div>
            
            <!-- Floating Camera Button -->
            <button class="floating-camera-btn" id="floatingCameraBtn">
                <i class="fas fa-camera"></i>
            </button>
            <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;">

            <div class="list-controls" id="nListControls">
                <select id="nSortSelect" aria-label="정렬">
                    <option value="created_recent" selected>최근 생성순</option>
                    <option value="created_oldest">오래전 생성순</option>
                    <option value="round_desc">회독 높은 순</option>
                    <option value="round_asc">회독 낮은 순</option>
                    <option value="recent">최근 열어본 순</option>
                    <option value="oldest">예전에 열어본 순</option>
                </select>
            </div>

            <div class="question-list" id="roundNList"></div>
            
            <div class="empty-state" id="roundNEmpty">
                <i class="fas fa-inbox"></i>
                <p>아직 복습할 문제가 없습니다</p>
            </div>
        </div>

        <!-- Pop Quiz View -->
        <div class="round-view" id="settingsView" style="display: none;">
            <div class="pop-quiz-desc" id="popQuizDesc">
                <div class="desc-icon">🎯</div>
                <div class="desc-text">
                    <div class="desc-title">팝퀴즈 안내</div>
                    <div class="desc-body">n회독이 끝난 문제들이 뜬금없는 시점에 제시됩니다.<br/>한번 제시된 문제는 아래 목록에서 찾아보실 수 있어요.</div>
                </div>
            </div>
            <div class="pop-quiz-status" id="popQuizStatus">
                <div class="status-row">
                    <span>팝퀴즈 대기중인 문제</span>
                    <strong id="popQuizWaitingCountStat">0개</strong>
                </div>
                <div class="status-row">
                    <span>퀴즈 전 평균 회독 수</span>
                    <strong id="popQuizAvgRoundStat">0.00회독</strong>
                </div>
            </div>
            <div class="pop-quiz-container" id="popQuizContainer"></div>
            
            <div class="empty-state" id="popQuizEmpty">
                <i class="fas fa-inbox"></i>
                <p>아직 팝퀴즈 문제가 없습니다</p>
            </div>
        </div>
        
        <!-- Achievement View -->
        <div class="round-view" id="achievementView" style="display: none;">
            <div class="pop-quiz-desc">
                <div class="desc-icon">🏆</div>
                <div class="desc-text">
                    <div class="desc-title">달성 완료</div>
                    <div class="desc-body">팝퀴즈에서 정답을 맞힌 문제들입니다.<br/>정답 문제 5개 마다 네이버 포인트 1,000원을 받을 수 있어요.</div>
                </div>
            </div>
            <div class="pop-quiz-status" id="achievementStatus" style="display:none !important;">
                <div class="status-row scholarship-cta-row">
                    <button id="scholarshipCtaBtn" class="scholarship-cta-btn" disabled>
                        <i class="fas fa-graduation-cap"></i>
                        <span>장학금 받기 - 네이버 포인트 1,000원</span>
                        <small id="scholarshipProgress">(0/5 달성완료)</small>
                    </button>
                </div>
            </div>
            <div class="question-list" id="achievementList"></div>
            <div class="empty-state" id="achievementEmpty">
                <i class="fas fa-trophy"></i>
                <p>아직 성취한 문제가 없습니다</p>
            </div>
        </div>

        <!-- Image Review View -->
        <div class="image-review-view" id="imageReviewView" style="display: none;">
            <div class="review-header">
                <button class="back-btn" id="backToCameraFromReview">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2>문제를 분류해주세요</h2>
                <button class="back-btn" id="deleteFromReview" title="삭제">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            
            <div class="swipe-container">
                <div class="image-card" id="imageCard">
                    <img id="reviewImage" src="" alt="문제 이미지">
                </div>
            </div>

            <div class="solution-notes" style="padding: 16px 20px; background:#fff;">
                <h3 style="margin-bottom:8px;">정답 입력란</h3>
                <p style="color:#666; margin:0 0 10px; font-size:0.92rem;">⚠️ 정답이 입력되지 않으면 팝퀴즈 기능을 활용할 수 없어요.</p>
                <input id="reviewAnswerInput" type="text" placeholder="정답을 입력하세요" style="width:100%; border:2px solid #eee; border-radius:8px; padding:12px; font-size:0.95rem;" />
            </div>
            
            <div class="review-actions">
                <button class="action-btn wrong" id="wrongBtn">
                    <i class="fas fa-times-circle"></i>
                    <span>틀린 문제</span>
                </button>
                <button class="action-btn ambiguous" id="ambiguousBtn">
                    <i class="fas fa-question-circle"></i>
                    <span>애매한 문제</span>
                </button>
            </div>
        </div>
        
        <!-- Solution View -->
        <div class="solution-view" id="solutionView" style="display: none;">
            <div class="solution-header">
                <button class="back-btn" id="backFromSolution">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="solution-title">
                    <h2 id="solutionQuestionNumber">문제 1</h2>
                    <span class="solution-category" id="solutionCategory"></span>
                </div>
                <button class="back-btn" id="deleteFromSolution" title="삭제">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            
            <div class="solution-content">
                <div class="solution-image-container">
                    <img id="solutionImage" src="" alt="문제 이미지">
                </div>
                
                <div class="solution-process">
                    <div class="solution-notes">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <h3 style="margin: 0;">정답 입력란</h3>
                            <span id="answerValue" style="color:#111; display:none; font-weight:600; margin: 0 10px;">정답을 알려주세요</span>
                            <button id="answerReveal" class="btn-secondary" style="padding:6px 10px;">보기</button>
                        </div>
                        <p style="color:#666; margin:6px 0 10px; font-size:0.92rem;">⚠️ 정답이 입력되지 않으면 팝퀴즈 기능을 활용할 수 없어요.</p>
                        <div style="display:flex; gap:8px; align-items:center;">
                            <input id="solutionAnswerInput" type="text" placeholder="정답을 입력하세요" style="flex:1; border:2px solid #eee; border-radius:8px; padding:12px; font-size:0.95rem;" />
                            <button id="solutionAnswerSubmit" class="btn-primary"><i class="fas fa-paper-plane"></i><span>제출</span></button>
                        </div>
                    </div>
                    
                    <!-- Work Process Note Container -->
                    <div class="solution-notes" style="margin-top: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <h3 style="margin: 0;">풀이 입력</h3>
                        </div>
                        <p style="color:#666; margin:6px 0 10px; font-size:0.92rem;">📷 풀이 과정을 사진으로 저장해보세요.</p>
                        
                        <!-- Camera Input Interface -->
                        <div id="workProcessCameraInterface" style="display:flex; gap:8px; align-items:center;">
                            <button id="workProcessCameraBtn" class="btn-secondary" style="flex:1; display:flex; align-items:center; justify-content:center; gap:8px; padding:12px;">
                                <i class="fas fa-camera"></i>
                                <span>사진 추가</span>
                            </button>
                        </div>
                        
                        <!-- Images Display Container -->
                        <div id="workProcessImagesContainer" style="display:none; margin-top:12px;">
                            <div id="workProcessImagesList" style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px;">
                                <!-- Images will be dynamically added here -->
                            </div>
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <span id="workProcessImageCount" style="color:#666; font-size:0.9rem;">0개 이미지</span>
                                <button id="workProcessAddMoreBtn" class="btn-secondary" style="padding:6px 10px; font-size:0.85rem;">
                                    <i class="fas fa-plus"></i>
                                    <span>추가</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Hidden file input -->
                        <input type="file" id="workProcessFileInput" accept="image/*" capture="environment" style="display:none;" multiple>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Quiz Modal -->
    <div class="image-popup-overlay" id="quizModal" style="display: none;">
        <div class="image-popup-content">
            <div class="quiz-image-container">
                <img id="quizImage" src="" alt="문제 이미지">
            </div>
            <div class="quiz-answer-panel">
                <input id="quizAnswer" type="text" placeholder="정답을 입력하세요" />
                <button id="quizSubmit" class="btn-primary"><i class="fas fa-paper-plane"></i><span>제출</span></button>
                <div id="quizResult" class="quiz-result" style="display:none !important;"></div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="image-popup-overlay" id="successModal" style="display: none;">
        <div class="image-popup-content success-content">
            <div class="celebration" aria-hidden="true">
                <span class="confetti"></span>
                <span class="confetti"></span>
                <span class="confetti"></span>
                <span class="confetti"></span>
                <span class="confetti"></span>
            </div>
            <div class="success-body">
                <div class="success-emoji">🎉</div>
                <h3>정답입니다!</h3>
                <p>이제 이 문제를 완벽히 이해하신 것 같네요!</p>
            </div>
            <div class="success-actions" id="successMainActions">
                <button id="successLaterBtn" class="btn-secondary">나중에 또 퀴즈로 풀어볼래요</button>
                <button id="successUnderstoodBtn" class="btn-primary">이 문제는 완전히 이해했어요!</button>
            </div>
            <div class="success-actions" id="successDelayOptions" style="display:none; flex-direction:column; gap:8px;">
                <button id="success5mBtn" class="btn-primary" style="width:100%;">5분뒤에 다시 풀어볼래요</button>
                <button id="success1hBtn" class="btn-primary" style="width:100%;">1시간 뒤에 다시 풀어볼래요</button>
                <button id="success1dBtn" class="btn-primary" style="width:100%;">내일 다시 풀어볼래요</button>
            </div>
        </div>
    </div>

    <!-- Fail Modal -->
    <div class="image-popup-overlay" id="failModal" style="display: none;">
        <div class="image-popup-content encourage-content">
            <div class="encourage-visual" aria-hidden="true">
                <div class="encourage-emoji">💪</div>
                <div class="sparkles">
                    <span class="sparkle"></span>
                    <span class="sparkle"></span>
                    <span class="sparkle"></span>
                </div>
            </div>
            <div class="encourage-body">
                <h3>조금만 더!</h3>
                <p>아쉽지만 정답이 아니네요.. 조금 더 공부한 다음에 다시 풀어보도록 해요!</p>
            </div>
            <div class="encourage-actions">
                <button id="failRetryBtn" class="btn-primary">다시 풀어볼래요</button>
            </div>
        </div>
    </div>

    <!-- Answer Required Modal -->
    <div class="image-popup-overlay" id="answerReqModal" style="display:none !important;">
        <div class="image-popup-content" style="max-width:520px;">
            <button class="popup-close" id="answerReqClose"><i class="fas fa-times"></i></button>
            <div style="padding: 8px 0 12px; text-align:center;">
                <div style="font-size:1.6rem; margin-bottom:6px;">✍️</div>
                <h3 style="margin:0 0 6px;">정답을 입력해 주세요</h3>
                <p style="margin:0; color:#666; font-size:0.92rem;">팝퀴즈 기능을 사용하려면 정답이 필요해요.</p>
            </div>
            <div style="display:flex; gap:8px; align-items:center; padding-top:6px;">
                <input id="answerReqInput" type="text" placeholder="정답을 입력하세요" style="flex:1; border:2px solid #eee; border-radius:8px; padding:12px; font-size:0.95rem;" />
                <button id="answerReqSubmit" class="btn-primary">저장하고 퀴즈로</button>
            </div>
        </div>
    </div>

    <!-- Work Process Image Modal -->
    <div class="image-popup-overlay" id="workProcessImageModal" style="display: none;">
        <div class="image-popup-content" style="max-width: 90vw; max-height: 90vh; padding: 0; background: transparent;">
            <button class="popup-close" id="workProcessImageClose" style="position: absolute; top: 10px; right: 10px; z-index: 10; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-times"></i>
            </button>
            <div style="position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                <img id="workProcessModalImage" src="" alt="풀이 과정 이미지" style="max-width: 100%; max-height: 100%; object-fit: contain;">
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-item active" id="navNRound">
            <i class="fas fa-redo"></i>
            <span>n회독</span>
        </button>
        <button class="nav-item" id="navSettings">
            <i class="fas fa-question-circle"></i>
            <span>팝퀴즈</span>
            <span class="quiz-badge" id="quizBadge" style="display: none;"></span>
        </button>
        <button class="nav-item" id="navAchievement">
            <i class="fas fa-trophy"></i>
            <span>성취도</span>
        </button>
    </nav>

    <script src="script.js"></script>
</body>
</html>